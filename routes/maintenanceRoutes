const express = require('express');
const router = express.Router();
const Maintenance = require('../models/Maintenance'); // Ensure the Maintenance model exists

// Add a maintenance log
router.post('/', async (req, res) => {
    try {
        const { laptopId, description, status, cost } = req.body;
        const maintenanceLog = new Maintenance({
            laptopId,
            description,
            status,
            cost,
            loggedAt: new Date(),
        });
        await maintenanceLog.save();
        res.status(201).json(maintenanceLog);
    } catch (err) {
        res.status(500).json({ message: 'Error creating maintenance log', error: err.message });
    }
});

// View all maintenance logs
router.get('/', async (req, res) => {
    try {
        const maintenanceLogs = await Maintenance.find();
        res.json(maintenanceLogs);
    } catch (err) {
        res.status(500).json({ message: 'Error fetching maintenance logs', error: err.message });
    }
});

// View maintenance history for a specific laptop
router.get('/:laptopId', async (req, res) => {
    try {
        const { laptopId } = req.params;
        const maintenanceLogs = await Maintenance.find({ laptopId });
        res.json(maintenanceLogs);
    } catch (err) {
        res.status(500).json({ message: 'Error fetching maintenance history', error: err.message });
    }
});

module.exports = router;
